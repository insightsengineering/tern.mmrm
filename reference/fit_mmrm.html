<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Does the MMRM analysis. Multiple other functions can be called on the result to produce
tables and graphs."><title>MMRM Analysis — fit_mmrm • tern.mmrm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MMRM Analysis — fit_mmrm"><meta property="og:description" content="Does the MMRM analysis. Multiple other functions can be called on the result to produce
tables and graphs."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="../consent.css"><script src="../consent.js" type="text/javascript" charset="utf-8"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tern.mmrm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9003</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/tern-mmrm.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern.mmrm/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern.mmrm/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern.mmrm/v0.3.0">v0.3.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern.mmrm/v0.2.1">v0.2.1</a> </div></li>
<!-- end dropdown for versions -->
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/tern.mmrm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1><code>MMRM</code> Analysis</h1>
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/tern.mmrm/blob/HEAD/R/fit_mmrm.R" class="external-link"><code>R/fit_mmrm.R</code></a></small>
      <div class="d-none name"><code>fit_mmrm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Does the <code>MMRM</code> analysis. Multiple other functions can be called on the result to produce
tables and graphs.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">fit_mmrm</span><span class="op">(</span>
  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>response <span class="op">=</span> <span class="st">"AVAL"</span>, covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, id <span class="op">=</span> <span class="st">"USUBJID"</span>, arm <span class="op">=</span> <span class="st">"ARM"</span>, visit <span class="op">=</span>
    <span class="st">"AVISIT"</span><span class="op">)</span>,
  <span class="va">data</span>,
  conf_level <span class="op">=</span> <span class="fl">0.95</span>,
  cor_struct <span class="op">=</span> <span class="st">"unstructured"</span>,
  weights_emmeans <span class="op">=</span> <span class="st">"proportional"</span>,
  averages_emmeans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,
  optimizer <span class="op">=</span> <span class="st">"automatic"</span>,
  parallel <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>vars</dt>
<dd><p>(named <code>list</code> of <code>string</code> or <code>character</code>)<br> specifying the variables in the <code>MMRM</code>.
The following elements need to be included as character vectors and match corresponding columns
in <code>data</code>:</p><dl><dt>response</dt>
<dd><p>the response variable</p></dd>

<dt>covariates</dt>
<dd><p>the additional covariate terms (might also include interactions)</p></dd>

<dt>id</dt>
<dd><p>the subject ID variable</p></dd>

<dt>arm</dt>
<dd><p>the treatment group variable (factor)</p></dd>

<dt>visit</dt>
<dd><p>the visit variable (factor)</p></dd>


</dl><p>Note that the main effects and interaction of <code>arm</code> and <code>visit</code> are by default included in the model.</p></dd>


<dt>data</dt>
<dd><p>a <code>data.frame</code> with all the variables specified in
<code>vars</code>. Records with missing values in any independent variables
will be excluded.</p></dd>


<dt>conf_level</dt>
<dd><p>(<code>proportion</code>)<br> confidence level of the interval.</p></dd>


<dt>cor_struct</dt>
<dd><p>a string specifying the correlation structure, defaults to
<code>"unstructured"</code>. See the details.</p></dd>


<dt>weights_emmeans</dt>
<dd><p>argument from <code><a href="https://rdrr.io/pkg/emmeans/man/emmeans.html" class="external-link">emmeans::emmeans()</a></code>, "proportional" by default.</p></dd>


<dt>averages_emmeans</dt>
<dd><p>(<code>list</code>)<br> optional named list of visit levels which should be averaged
and reported along side the single visits.</p></dd>


<dt>optimizer</dt>
<dd><p>a string specifying the optimization algorithm which should be used. By default, "automatic"
will (if necessary) try all possible optimization algorithms and choose the best result. If another algorithm
is chosen and does not give a valid result, an error will occur.</p></dd>


<dt>parallel</dt>
<dd><p>flag that controls whether "automatic" optimizer search can use available free cores on the
machine (not default).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An <code>mmrm</code> object which is a list with MMRM results:</p><dl><dt>fit</dt>
<dd><p>The <code>lmerModLmerTest</code> object which was fitted to the data. Note that the attribute <code>optimizer</code>
contains the finally used optimization algorithm, which can be useful for refitting the model later on.</p></dd>

<dt>cov_estimate</dt>
<dd><p>The matrix with the covariance matrix estimate.</p></dd>

<dt>diagnostics</dt>
<dd><p>A list with model diagnostic statistics (REML criterion, AIC, corrected AIC, BIC).</p></dd>

<dt>lsmeans</dt>
<dd><p>This is a list with data frames <code>estimates</code> and <code>contrasts</code>.</p></dd>

<dt>vars</dt>
<dd><p>The variable list.</p></dd>

<dt>labels</dt>
<dd><p>Corresponding list with variable labels extracted from <code>data</code>.</p></dd>

<dt>ref_level</dt>
<dd><p>The reference level for the arm variable, which is always the first level.</p></dd>

<dt>conf_level</dt>
<dd><p>The confidence level which was used to construct the confidence intervals.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Only Satterthwaite adjusted degrees of freedom (d.f.) are supported, because they
match the results obtained in SAS (confirmed for unstructured and compound symmetry correlation structures).</p>
<p>For the correlation structure (<code>cor_struct</code>), the user can choose among the following options, sorted
in descending number of variance parameters:</p><dl><dt>unstructured</dt>
<dd><p>Unstructured covariance matrix. This is the most flexible choice and default.
If there are <code>T</code> visits, then <code>T * (T+1) / 2</code> variance parameters are used.
Note: the current actual implementation uses one more variance parameter, which does not have any
effect of the results. Therefore we report here the actually relevant number of parameters.</p></dd>

<dt>random-quadratic</dt>
<dd><p>Random quadratic spline for the random effects of the time variable.
7 variance parameters are used.</p></dd>

<dt>random-slope</dt>
<dd><p>Random slope for the random effects of the time variable. 4 variance parameters are used.</p></dd>

<dt>compound-symmetry</dt>
<dd><p>Constant correlation between visits. 2 variance parameters are used.</p></dd>


</dl><p>For the <code>optimizer</code>, the user can choose among the following alternatives to the recommended "automatic":</p><dl><dt>nloptwrap_neldermead</dt>
<dd><p><code>NLopt</code> version of the Nelder-Mead algorithm (via package <code>nloptr</code>)</p></dd>

<dt>nloptwrap_bobyqa</dt>
<dd><p><code>NLopt</code> version of the BOBYQA algorithm (via package <code>nloptr</code>)</p></dd>

<dt>bobyqa</dt>
<dd><p>BOBYQA algorithm (via package <code>minqa</code>)</p></dd>

<dt>nlminbwrap</dt>
<dd><p>nlminb algorithm (wrapper for <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a>)</code></p></dd>

<dt>neldermead</dt>
<dd><p><code>lme4</code> version of the Nelder-Mead algorithm with box constraints (via package <code>lme4</code>)</p></dd>

<dt>nmkbw</dt>
<dd><p>Nelder-Mead algorithm (via package <code>dfoptim</code>)</p></dd>

<dt>optimx_lbfgsb</dt>
<dd><p>L-BFGS-B algorithm (via package <code>optimx</code>)</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The ordering of the input data sets can lead to slightly different numerical results or
different convergence behavior. This is a known observation with the used package
<code>lme4</code>. However, once convergence is achieved, the results are reliable up to
numerical precision.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/roche/rtables" class="external-link">rtables</a></span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="va">mmrm_results</span> <span class="op">&lt;-</span> <span class="fu">fit_mmrm</span><span class="op">(</span></span>
<span class="r-in">  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span class="r-in">    response <span class="op">=</span> <span class="st">"FEV1"</span>,</span>
<span class="r-in">    covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"SEX"</span><span class="op">)</span>,</span>
<span class="r-in">    id <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span class="r-in">    arm <span class="op">=</span> <span class="st">"ARMCD"</span>,</span>
<span class="r-in">    visit <span class="op">=</span> <span class="st">"AVISIT"</span></span>
<span class="r-in">  <span class="op">)</span>,</span>
<span class="r-in">  data <span class="op">=</span> <span class="va">mmrm_test_data</span>,</span>
<span class="r-in">  cor_struct <span class="op">=</span> <span class="st">"random-quadratic"</span>,</span>
<span class="r-in">  weights_emmeans <span class="op">=</span> <span class="st">"equal"</span>,</span>
<span class="r-in">  averages_emmeans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span class="r-in">    <span class="st">"VIS1+2"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VIS1"</span>, <span class="st">"VIS2"</span><span class="op">)</span></span>
<span class="r-in">  <span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="nest">
  <p>tern.mmrm is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer></div>

  

  

  </body></html>

