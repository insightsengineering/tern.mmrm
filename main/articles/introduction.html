<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to tern.mmrm â€¢ tern.mmrm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to tern.mmrm">
<link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tern.mmrm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction to tern.mmrm</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      <div><li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern.mmrm/release-candidate">release-candidate</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern.mmrm/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern.mmrm/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern.mmrm/v0.3.3-rc1">v0.3.3-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern.mmrm/v0.3.2">v0.3.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern.mmrm/v0.3.1">v0.3.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern.mmrm/v0.3.0">v0.3.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern.mmrm/v0.2.1">v0.2.1</a>
</div>
</li></div>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/tern.mmrm"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to tern.mmrm</h1>
            
            <h4 data-toc-skip class="date">2022-03-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/tern.mmrm/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Mixed effect Models with Repeated Measures (MMRM) are often used as
the primary analysis of continuous longitudinal endpoints in clinical
trials. In this setting, an MMRM is a specific linear mixed effects
model that includes as fixed effects the variables: treatment arm,
categorical visit, treatment by visit interaction, and other covariates
for adjustment (e.g.Â age, gender). The covariance structure of the
residuals can take on different forms. Often, an unstructured
(i.e.Â saturated parametrization) covariance matrix is assumed which can
be represented by random effects in the mixed model.</p>
<p>All of this has been implemented in proprietary software such as
<code>SAS</code>, whose <code>PROC MIXED</code> routine is generally
considered the gold standard for mixed models. However, this does not
allow the use of interactive web applications to explore the clinical
study data in a flexible way. Therefore, we wanted to implement MMRM in
R in a way which could easily be embedded into a <code>shiny</code>
application. See the <a href="https://insightsengineering.github.io/teal.modules.clinical/" class="external-link"><code>teal.modules.clinical</code>
package</a> for more details about using this code inside a
<code>shiny</code> application.</p>
</div>
<div class="section level2">
<h2 id="descriptive-statistics">Descriptive Statistics<a class="anchor" aria-label="anchor" href="#descriptive-statistics"></a>
</h2>
<p>Descriptive statistics for a relevant analysis population (e.g.Â those
patients with at least one post baseline visit) can be obtained by the
functions described in Section @ref(baseline-tables).</p>
</div>
<div class="section level2">
<h2 id="methodology">Methodology<a class="anchor" aria-label="anchor" href="#methodology"></a>
</h2>
<div class="section level3">
<h3 id="statistical-model">Statistical model<a class="anchor" aria-label="anchor" href="#statistical-model"></a>
</h3>
<p>Under the linear mixed model (<code>LMM</code>) framework, an outcome
vector <span class="math inline">${\bf Y}$</span> is modeled as <span class="math display">$$\bf Y = X \boldsymbol \beta + Z b + {\boldsymbol
\varepsilon}$$</span> where <span class="math inline">$\bf X$</span> is
the matrix for fixed effects, <span class="math inline">$\bf Z$</span>
is the matrix for random effects,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›</mi><mo>âˆ¼</mo><mi>N</mi><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>ğƒ</mi><mo stretchy="false" form="prefix">(</mo><mi>ğ›‰</mi><mo stretchy="false" form="postfix">)</mo><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\mathbf b \sim N(0, \mathbf D(\boldsymbol \theta))</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›†</mi><mo>âˆ¼</mo><mi>N</mi><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>ğ‘</mi><mo stretchy="false" form="prefix">(</mo><mi>ğ›‰</mi><mo stretchy="false" form="postfix">)</mo><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">{\boldsymbol \varepsilon} \sim N(0, \mathbf R(\boldsymbol \theta))</annotation></semantics></math>.
Letting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ•</mi><mo>=</mo><mi>ğ™</mi><mi>ğƒ</mi><msup><mi>ğ™</mi><mi>T</mi></msup><mo>+</mo><mi>ğ‘</mi></mrow><annotation encoding="application/x-tex">\mathbf V = \mathbf Z \mathbf D \mathbf Z^T + \mathbf R</annotation></semantics></math>,
the marginal and conditional models are then given by <span class="math inline">$\mathbf Y \sim N(\bf X \boldsymbol \beta,
V)$</span> and <span class="math inline">$\mathbf Y | \mathbf b \sim
N(\bf X \boldsymbol \beta + Z b, R)$</span>, respectively.</p>
<p>An MMRM is a special case of a <code>LMM</code> such that <span class="math inline">$\bf Y$</span> is a collection of measurements made
on a set of individuals over time, i.e.Â <span class="math inline">$\mathbf Y = ({\bf Y}_1^T, {\bf Y}_2^T,
...)^T$</span> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ˜</mi><mi>i</mi></msub><mo>=</mo><msub><mi>ğ—</mi><mi>i</mi></msub><mi>ğ›ƒ</mi><mo>+</mo><msub><mi>ğ™</mi><mi>i</mi></msub><msub><mi>ğ›</mi><mi>i</mi></msub><mo>+</mo><msub><mi>ğ›†</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\mathbf Y_i = \mathbf X_i \boldsymbol \beta + \mathbf Z_i \mathbf b_i + {\boldsymbol \varepsilon}_i</annotation></semantics></math>.
In our context of clinical trials, individuals are patients identified
by their unique subject <code>id</code>, measurements are of treatment
<code>response</code>, and fixed effects include treatment
<code>arm</code>, categorical <code>visit</code>, treatment by visit
interaction, and potentially other <code>covariates</code> (e.g.Â age,
gender).</p>
</div>
<div class="section level3">
<h3 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a>
</h3>
<p>The parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›ƒ</mi><annotation encoding="application/x-tex">\boldsymbol \beta</annotation></semantics></math>,
<span class="math inline">$\bf b$</span>, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›‰</mi><annotation encoding="application/x-tex">\boldsymbol \theta</annotation></semantics></math>
can be estimated by maximizing the penalized and restricted maximum
likelihoods. The average treatment response at each visit is often of
particular interest. However, simply comparing predicted marginal
responses
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo stretchy="false" form="prefix">(</mo><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">E(Y_{ij})</annotation></semantics></math>
averaged across treatment x visit groups will not account for potential
imbalance in covariates. (Imbalance may occur even in randomized trials
due to patients dying or dropping out over time.) For a more fair
comparison, <strong>least-squares (LS) mean</strong>:</p>
<ol style="list-style-type: decimal">
<li>establishes a reference grid where each cell represents a unique
combination of the factor (covariate) levels,</li>
<li>calculates the predicted marginal response for each cell, and
then</li>
<li>takes a weighted average of the predicted marginal responses.</li>
</ol>
<p>The following simple example illustrates the concept of LS means.
Suppose we have a longitudinal clinical trial where three factors are
considered: treatment (A and B), visit (1, 2, â€¦), and gender (M and F).
The marginal predicted response (sample size) for each reference cell is
as follows.</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="center">A1</th>
<th align="center">B1</th>
<th align="center">â€¦</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">M</td>
<td align="center">100 (20)</td>
<td align="center">90 (35)</td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="left">F</td>
<td align="center">50 (30)</td>
<td align="center">40 (15)</td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>The average predicted responses for arms A and B at Visit 1 are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mn>100</mn><mo>Ã—</mo><mn>20</mn><mo>+</mo><mn>50</mn><mo>Ã—</mo><mn>30</mn><mo stretchy="false" form="postfix">)</mo><mi>/</mi><mn>50</mn><mo>=</mo><mn>70</mn></mrow><annotation encoding="application/x-tex">(100 \times 20 + 50 \times 30) / 50 = 70</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mn>90</mn><mo>Ã—</mo><mn>35</mn><mo>+</mo><mn>40</mn><mo>Ã—</mo><mn>15</mn><mo stretchy="false" form="postfix">)</mo><mi>/</mi><mn>50</mn><mo>=</mo><mn>75</mn></mrow><annotation encoding="application/x-tex">(90 \times 35 + 40 \times 15) / 50 = 75</annotation></semantics></math>,
respectively. The overall mean is higher in arm B than in arm A even
though the mean is lower within each gender category. This seeming
contradiction is caused by the imbalance in the data. LS mean calculates
the weighted average across cells of the same treatment and visit. In
this example, this is equivalent to taking the weighted average over
each column. One may assign <em>equal</em> weights to each cell,
i.e.Â <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>Ã—</mo><mn>100</mn><mo>+</mo><mn>0.5</mn><mo>Ã—</mo><mn>50</mn><mo>=</mo><mn>75</mn></mrow><annotation encoding="application/x-tex">0.5 \times 100 + 0.5 \times 50 = 75</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.5</mn><mo>Ã—</mo><mn>90</mn><mo>+</mo><mn>0.5</mn><mo>Ã—</mo><mn>40</mn><mo>=</mo><mn>65</mn></mrow><annotation encoding="application/x-tex">0.5 \times 90 + 0.5 \times 40 = 65</annotation></semantics></math>.
Alternatively, one may assign weights <em>proportional</em> to the
observed frequencies of the factor combinations,
i.e.Â <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.55</mn><mo>Ã—</mo><mn>100</mn><mo>+</mo><mn>0.45</mn><mo>Ã—</mo><mn>50</mn><mo>=</mo><mn>77.5</mn></mrow><annotation encoding="application/x-tex">0.55 \times 100 + 0.45 \times 50 = 77.5</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.55</mn><mo>Ã—</mo><mn>90</mn><mo>+</mo><mn>0.45</mn><mo>Ã—</mo><mn>40</mn><mo>=</mo><mn>67.5</mn></mrow><annotation encoding="application/x-tex">0.55 \times 90 + 0.45 \times 40 = 67.5</annotation></semantics></math>.
In both cases, the LS mean of response is lower in arm B than in arm
A.</p>
<p>LS means are calculated in <code>tern.mmrm</code> via the R package
<code>emmeans</code>. Users have the option to weigh marginal predicted
responses with either <code>equal</code> weights or
<code>proportional</code> weights. Note that for proportional weights,
the weights are calculated at each visit by taking into account the
observed frequencies of factor combinations at that time. Therefore,
even though covariate imbalance may vary over time, LS mean provides an
adjusted analysis of treatment response at all visits.</p>
</div>
<div class="section level3">
<h3 id="inference">Inference<a class="anchor" aria-label="anchor" href="#inference"></a>
</h3>
<p>Performing inference on estimated parameters (e.g.Â calculating
p-values) is less straightforward for MMRM. This is because the exact
null distributions for parameter effects are unknown. <code>SAS</code>
addresses this issue by utilizing Satterthwaiteâ€™s method to approximate
the adjusted degrees of freedom for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
tests. <code>lme4</code> and <code>lmerTest</code> have also implemented
Satterthwaiteâ€™s method. Unfortunately we found that these are not robust
in their convergence behavior. Compared to <code>lme4</code>, the R
package <code>nlme</code> can consider more flexible covariance
structures. However, we have chosen not to use this package because it
does not provide exact Satterthwaite adjusted degrees of freedom and the
available approximate degrees of freedom can differ substantially.
Therefore we built the new package <code>mmrm</code>. With
<code>mmrm</code>, <code>tern.mmrm</code> is able to replicate outputs
from <code>SAS</code>.</p>
</div>
<div class="section level3">
<h3 id="covariance-structure">Covariance structure<a class="anchor" aria-label="anchor" href="#covariance-structure"></a>
</h3>
<p>Users of <code>tern.mmrm</code> have currently the following options
for the covariance structure
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ğ•</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mathbf V_i</annotation></semantics></math>:</p>
<ul>
<li>Unstructured:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>Î¸</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">V_{ij} = \theta_{ij}</annotation></semantics></math>
</li>
<li>Homogeneous AR(1):
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><msub><mi>ğ•</mi><mi>i</mi></msub><msub><mo stretchy="false" form="postfix">)</mo><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>=</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><msup><mi>Ï</mi><mrow><mo stretchy="false" form="prefix">|</mo><mi>j</mi><mo>âˆ’</mo><mi>k</mi><mo stretchy="false" form="prefix">|</mo></mrow></msup></mrow><annotation encoding="application/x-tex">(\mathbf V_i)_{jk} = \sigma^2 \rho^{|j-k|}</annotation></semantics></math>
</li>
<li>Heterogeneous AR(1):
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><msub><mi>ğ•</mi><mi>i</mi></msub><msub><mo stretchy="false" form="postfix">)</mo><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>=</mo><msub><mi>Ïƒ</mi><mi>j</mi></msub><msub><mi>Ïƒ</mi><mi>k</mi></msub><msup><mi>Ï</mi><mrow><mo stretchy="false" form="prefix">|</mo><mi>j</mi><mo>âˆ’</mo><mi>k</mi><mo stretchy="false" form="prefix">|</mo></mrow></msup></mrow><annotation encoding="application/x-tex">(\mathbf V_i)_{jk} = \sigma_j \sigma_k \rho^{|j-k|}</annotation></semantics></math>
</li>
<li>Heterogeneous Toeplitz:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><msub><mi>ğ•</mi><mi>i</mi></msub><msub><mo stretchy="false" form="postfix">)</mo><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>=</mo><msub><mi>Ïƒ</mi><mi>j</mi></msub><msub><mi>Ïƒ</mi><mi>k</mi></msub><msub><mi>Î¸</mi><mrow><mo stretchy="false" form="prefix">|</mo><mi>j</mi><mo>âˆ’</mo><mi>k</mi><mo stretchy="false" form="prefix">|</mo></mrow></msub></mrow><annotation encoding="application/x-tex">(\mathbf V_i)_{jk}=\sigma_j \sigma_k \theta_{|j-k|}</annotation></semantics></math>
</li>
<li>Heterogeneous Ante-Dependence:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><msub><mi>ğ•</mi><mi>i</mi></msub><msub><mo stretchy="false" form="postfix">)</mo><mrow><mi>j</mi><mi>k</mi></mrow></msub><mo>=</mo><msub><mi>Ïƒ</mi><mi>j</mi></msub><msub><mi>Ïƒ</mi><mi>k</mi></msub><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mi>j</mi></mrow><mi>k</mi></munderover><msub><mi>Ï</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">(\mathbf V_i)_{jk} = \sigma_j \sigma_k \prod_{i=j}^{k}\rho_i</annotation></semantics></math>
</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="model-fitting">Model fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h2>
<p>In this section, we illustrate how to fit a MMRM with
<code>tern.mmrm</code> and how to fit a MMRM manually in R. We then
compare with <code>SAS</code> to show that the results match.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>Our example dataset consists of several variables: subject ID
(<code>USUBJID</code>), visit number (<code>AVISIT</code>), treatment
(<code>ARMCD</code> = <code>TRT</code> or <code>PBO</code>), 3-category
race, sex, <code>FEV1</code> at baseline (%), and <code>FEV1</code> at
study visits (%). <code>FEV1</code> (forced expired volume in one
second) is a measure of how quickly the lungs can be emptied. Low levels
of <code>FEV1</code> may indicate chronic obstructive pulmonary disease
(<code>COPD</code>). The scientific question at hand is whether
treatment leads to an increase in <code>FEV1</code> over time after
adjusting for baseline covariates.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/insightsengineering/tern.mmrm" class="external-link">tern.mmrm</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: tern</span></span>
<span><span class="co">#&gt; Loading required package: rtables</span></span>
<span><span class="co">#&gt; Loading required package: formatters</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'formatters'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     %||%</span></span>
<span><span class="co">#&gt; Loading required package: magrittr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'rtables'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     str</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'tern':</span></span>
<span><span class="co">#&gt;   method   from </span></span>
<span><span class="co">#&gt;   tidy.glm broom</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mmrm_test_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mmrm_test_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 Ã— 7</span></span></span>
<span><span class="co">#&gt;   USUBJID AVISIT ARMCD RACE                      SEX    FEV1_BL  FEV1</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> PT1     VIS1   TRT   Black or African American Female    25.3  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> PT1     VIS2   TRT   Black or African American Female    25.3  40.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> PT1     VIS3   TRT   Black or African American Female    25.3  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> PT1     VIS4   TRT   Black or African American Female    25.3  20.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> PT2     VIS1   PBO   Asian                     Male      45.0  <span style="color: #BB0000;">NA</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> PT2     VIS2   PBO   Asian                     Male      45.0  31.5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-fitting-via-tern-mmrm">Model fitting via <code>tern.mmrm</code><a class="anchor" aria-label="anchor" href="#model-fitting-via-tern-mmrm"></a>
</h3>
<p>Fitting MMRM is easy in <code>tern.mmrm</code>. By default, the model
fitting function <code>fit_mmrm</code> assumes unstructured correlation
and proportional weights when calculating LS means.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mmrm_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_mmrm.html">fit_mmrm</a></span><span class="op">(</span></span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    response <span class="op">=</span> <span class="st">"FEV1"</span>,</span>
<span>    covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RACE"</span>, <span class="st">"SEX"</span>, <span class="st">"FEV1_BL"</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>    arm <span class="op">=</span> <span class="st">"ARMCD"</span>,</span>
<span>    visit <span class="op">=</span> <span class="st">"AVISIT"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mmrm_test_data</span>,</span>
<span>  cor_struct <span class="op">=</span> <span class="st">"unstructured"</span>,</span>
<span>  weights_emmeans <span class="op">=</span> <span class="st">"proportional"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The resulting object consists among other things the estimated random
and fixed effects (<code>fit</code>), the estimated LS means for a
particular treatment at a particular visit (<code>lsmeans</code>), and
the difference in LS means at a particular visit
(<code>lsmeans$contrasts</code>). Based on the output, there is evidence
that supports treatment leading to an increase in <code>FEV1</code> over
placebo at all study visits.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mmrm_results</span><span class="op">$</span><span class="va">lsmeans</span><span class="op">$</span><span class="va">contrasts</span></span>
<span><span class="co">#&gt;   ARMCD AVISIT estimate        se       df lower_cl upper_cl   t_stat</span></span>
<span><span class="co">#&gt; 1   TRT   VIS1 3.983290 1.0454036 142.3210 1.916765 6.049815 3.810289</span></span>
<span><span class="co">#&gt; 2   TRT   VIS2 3.930758 0.8135131 142.2576 2.322622 5.538895 4.831831</span></span>
<span><span class="co">#&gt; 3   TRT   VIS3 2.983718 0.6656674 129.6093 1.666737 4.300699 4.482295</span></span>
<span><span class="co">#&gt; 4   TRT   VIS4 4.404001 1.6604869 132.8789 1.119595 7.688407 2.652235</span></span>
<span><span class="co">#&gt;        p_value relative_reduc</span></span>
<span><span class="co">#&gt; 1 2.058960e-04    -0.12101832</span></span>
<span><span class="co">#&gt; 2 3.460313e-06    -0.10424997</span></span>
<span><span class="co">#&gt; 3 1.606280e-05    -0.06893864</span></span>
<span><span class="co">#&gt; 4 8.969722e-03    -0.09154581</span></span></code></pre></div>
<p>Other correlation structures and weighting schemes can be
considered.</p>
</div>
<div class="section level3">
<h3 id="model-fitting-manually-in-r">Model fitting manually in R<a class="anchor" aria-label="anchor" href="#model-fitting-manually-in-r"></a>
</h3>
<p>One can reproduce these results manually in R. For example, to fit
the unstructured model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://openpharma.github.io/mmrm/" class="external-link">mmrm</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'mmrm'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:tern.mmrm':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     fit_mmrm</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rvlenth.github.io/emmeans/" class="external-link">emmeans</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Welcome to emmeans.</span></span>
<span><span class="co">#&gt; Caution: You lose important information if you filter this package's results.</span></span>
<span><span class="co">#&gt; See '? untidy'</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://openpharma.github.io/mmrm/latest-tag/reference/mmrm.html" class="external-link">mmrm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">FEV1</span> <span class="op">~</span> <span class="va">RACE</span> <span class="op">+</span> <span class="va">SEX</span> <span class="op">+</span> <span class="va">FEV1_BL</span> <span class="op">+</span> <span class="va">ARMCD</span> <span class="op">*</span> <span class="va">AVISIT</span> <span class="op">+</span> <span class="fu">us</span><span class="op">(</span><span class="va">AVISIT</span> <span class="op">|</span> <span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mmrm_test_data</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">emmeans</span><span class="fu">::</span><span class="fu"><a href="https://rvlenth.github.io/emmeans/reference/emmeans.html" class="external-link">emmeans</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">pairwise</span> <span class="op">~</span> <span class="va">ARMCD</span> <span class="op">|</span> <span class="va">AVISIT</span>, weights <span class="op">=</span> <span class="st">"proportional"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $emmeans</span></span>
<span><span class="co">#&gt; AVISIT = VIS1:</span></span>
<span><span class="co">#&gt;  ARMCD emmean    SE  df lower.CL upper.CL</span></span>
<span><span class="co">#&gt;  PBO     32.9 0.732 141     31.5     34.4</span></span>
<span><span class="co">#&gt;  TRT     36.9 0.743 141     35.4     38.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; AVISIT = VIS2:</span></span>
<span><span class="co">#&gt;  ARMCD emmean    SE  df lower.CL upper.CL</span></span>
<span><span class="co">#&gt;  PBO     37.7 0.576 142     36.6     38.8</span></span>
<span><span class="co">#&gt;  TRT     41.6 0.570 140     40.5     42.8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; AVISIT = VIS3:</span></span>
<span><span class="co">#&gt;  ARMCD emmean    SE  df lower.CL upper.CL</span></span>
<span><span class="co">#&gt;  PBO     43.3 0.441 127     42.4     44.2</span></span>
<span><span class="co">#&gt;  TRT     46.3 0.494 130     45.3     47.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; AVISIT = VIS4:</span></span>
<span><span class="co">#&gt;  ARMCD emmean    SE  df lower.CL upper.CL</span></span>
<span><span class="co">#&gt;  PBO     48.1 1.170 133     45.8     50.4</span></span>
<span><span class="co">#&gt;  TRT     52.5 1.170 133     50.2     54.8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results are averaged over the levels of: RACE, SEX </span></span>
<span><span class="co">#&gt; Confidence level used: 0.95 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $contrasts</span></span>
<span><span class="co">#&gt; AVISIT = VIS1:</span></span>
<span><span class="co">#&gt;  contrast  estimate    SE  df t.ratio p.value</span></span>
<span><span class="co">#&gt;  PBO - TRT    -3.98 1.050 142  -3.810  0.0002</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; AVISIT = VIS2:</span></span>
<span><span class="co">#&gt;  contrast  estimate    SE  df t.ratio p.value</span></span>
<span><span class="co">#&gt;  PBO - TRT    -3.93 0.814 142  -4.832  &lt;.0001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; AVISIT = VIS3:</span></span>
<span><span class="co">#&gt;  contrast  estimate    SE  df t.ratio p.value</span></span>
<span><span class="co">#&gt;  PBO - TRT    -2.98 0.666 130  -4.482  &lt;.0001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; AVISIT = VIS4:</span></span>
<span><span class="co">#&gt;  contrast  estimate    SE  df t.ratio p.value</span></span>
<span><span class="co">#&gt;  PBO - TRT    -4.40 1.660 133  -2.652  0.0090</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results are averaged over the levels of: RACE, SEX</span></span></code></pre></div>
<p>Compared to manual implementation, <code>tern.mmrm</code> users can
avoid specifying the <code>formula</code> manually. Note also that
<code>tern.mmrm</code> has a default optimizer which is in fact the same
as the one shown here. If the default fails to converge, it
automatically attempts to use multiple other optimizers, delivering
results should there be a consensus.</p>
</div>
<div class="section level3">
<h3 id="model-fitting-via-sas">Model fitting via <code>SAS</code><a class="anchor" aria-label="anchor" href="#model-fitting-via-sas"></a>
</h3>
For the unstructured model, the equivalent <code>SAS</code> code is
given by
<div class="sas">
<pre class="sas"><code>proc import datafile="location_of_data.csv"
     out=dat
     dbms=csv
     replace;
     getnames=yes;
run;

proc mixed data= dat;
       class ARMCD(ref="PBO") AVISIT(ref="VIS1") USUBJID SEX(ref="Male") RACE(ref="Asian");
       Model FEV1 = ARMCD  RACE  SEX  FEV1_BL  AVISIT  ARMCD*AVISIT    / solution ddfm=satterthwaite;
       repeated AVISIT / type=UN subject=USUBJID;
       lsmeans ARMCD*AVISIT/pdiff obsmargins cl;
run;
</code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a>
</h2>
<div class="section level3">
<h3 id="model-fitting-1">Model fitting<a class="anchor" aria-label="anchor" href="#model-fitting-1"></a>
</h3>
<p>A key part in the analysis of data is model selection, where often
the desire is to select a parsimonious model that adequately fits the
data. We provide four of the same information criteria as found in
<code>SAS</code> <code>PROC MIXED</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mmrm_results</span><span class="op">$</span><span class="va">diagnostics</span></span>
<span><span class="co">#&gt; $`REML criterion`</span></span>
<span><span class="co">#&gt; [1] 3361.379</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $AIC</span></span>
<span><span class="co">#&gt; [1] 3381.379</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $AICc</span></span>
<span><span class="co">#&gt; [1] 3381.807</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $BIC</span></span>
<span><span class="co">#&gt; [1] 3414.211</span></span></code></pre></div>
<p>Each criterion is specifically calculated as follows:</p>
<ol style="list-style-type: decimal">
<li>
<code>REML</code> criterion:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>âˆ’</mi><mn>2</mn><mi>l</mi></mrow><annotation encoding="application/x-tex">-2 l</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>
is the <code>REML</code> log-likelihood. This criterion has no penalty
for complexity, so generally decreases as model becomes more
complex.</li>
<li>
<code>AIC</code>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>âˆ’</mi><mn>2</mn><mi>l</mi><mo>+</mo><mn>2</mn><mi>d</mi></mrow><annotation encoding="application/x-tex">-2l + 2d</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>
is the number of covariance parameters.</li>
<li>
<code>AICc</code>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>âˆ’</mi><mn>2</mn><mi>l</mi><mo>+</mo><mn>2</mn><mi>d</mi><msup><mi>n</mi><mo>*</mo></msup><mi>/</mi><mo stretchy="false" form="prefix">(</mo><msup><mi>n</mi><mo>*</mo></msup><mo>âˆ’</mo><mi>d</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">-2l + 2dn^*/(n^*-d-1)</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>n</mi><mo>*</mo></msup><annotation encoding="application/x-tex">n^*</annotation></semantics></math>
is the number of observations minus the number of fixed effects, or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">d + 2</annotation></semantics></math>
if it is smaller than that. <code>AICc</code> is a finite-sample
corrected version of <code>AIC</code>.</li>
<li>
<code>BIC</code>:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>âˆ’</mi><mn>2</mn><mi>l</mi><mo>+</mo><mi>d</mi><mrow><mi>log</mi><mo>â¡</mo></mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">-2l + d \log n</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
is the number of subjects as opposed to the number of observations.</li>
</ol>
<p>An objective approach to model selection is to minimize the
<code>AIC</code>, <code>AICc</code>, or <code>BIC</code>. For more
details on these information criteria (including references), see <a href="https://documentation.sas.com/?cdcId=statcdc&amp;cdcVersion=14.2&amp;docsetId=statug&amp;docsetTarget=statug_mixed_syntax01.htm&amp;locale=en#statug.mixed.procstmt_ic" class="external-link">SAS
Documentation</a>.</p>
</div>
<div class="section level3">
<h3 id="residual-analysis">Residual analysis<a class="anchor" aria-label="anchor" href="#residual-analysis"></a>
</h3>
<p>Another key part in the analysis of data is verifying model
assumptions. <code>g_mmrm_diagnostic(fit, type = ...)</code> provides
several handy residual plots, each of which is diagnostic for a
different aspect of MMRMs.</p>
<ul>
<li>Marginal fitted values
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ—</mi><mi>i</mi></msub><mover><mi>ğ›ƒ</mi><mo accent="true">Ì‚</mo></mover></mrow><annotation encoding="application/x-tex">\mathbf X_i \widehat {\boldsymbol \beta}</annotation></semantics></math>)
vs.Â Marginal residuals
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ğ˜</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>ğ—</mi><mi>i</mi></msub><mover><mi>ğ›ƒ</mi><mo accent="true">Ì‚</mo></mover></mrow><annotation encoding="application/x-tex">\mathbf Y_i - \mathbf X_i \widehat{\boldsymbol \beta}</annotation></semantics></math>)
<ul>
<li>Argument: <code>type = "fit-residual"</code>
</li>
<li>Diagnostic for: homoskedasticity of marginal residuals</li>
</ul>
</li>
<li>QQ plot of standardized marginal residuals
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mover><mi>ğ•</mi><mo accent="true">Ì‚</mo></mover><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn><mi>/</mi><mn>2</mn></mrow></msubsup><mo stretchy="false" form="prefix">(</mo><msub><mi>ğ˜</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>ğ—</mi><mi>i</mi></msub><mover><mi>ğ›ƒ</mi><mo accent="true">Ì‚</mo></mover><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\widehat{\mathbf V}_i^{-1/2} (\mathbf Y_i - \mathbf X_i \widehat{\boldsymbol \beta})</annotation></semantics></math>)
<ul>
<li>Argument: <code>type = q-q-residual</code>
</li>
<li>Diagnostic for: normality of marginal residuals</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="outlook">Outlook<a class="anchor" aria-label="anchor" href="#outlook"></a>
</h2>
<p>We are actively looking to expand the capabilities of
<code>tern.mmrm</code>. In particular we are working on the foundational
package <code>mmrm</code> to include more features, such as treatment
group specific covariance matrices and additional covariance
structures.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>tern.mmrm is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>





  </body>
</html>
